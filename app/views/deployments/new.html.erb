<%= stylesheet_link_tag 'deployment-page'%>
<%= render "layouts/topmenu_bar", user: @user %> 
<%= render "layouts/sidebar_menu", user: @user %> 

<div class="container">
  <div class = "card">
    <%= form_for :deployments, url: "/deployments" do |form| %>
      <div class="input-field col s12">
        <%= form.text_field :title ,class: 'form-group form-control', required: true %>
        <label for= "deployments_title">TITLE:</label>
      </div>
      <div class="input-field col s12">
        <%= form.text_area :overview ,class: 'materialize-textarea form-group form-control' %>
        <label for= "deployments_overview">OVERVIEW:</label>
      </div>
      <div class="input-field col s12">
        <%= form.text_area :committers ,class: 'materialize-textarea form-group form-control' %>
        <label for= "deployments_committers">COMMITTERS:</label>
      </div>
      <h5><b>SERVICES IMPACTED</b></h5>
      <%= form.text_area :service_impacted ,class: 'materialize-textarea form-group form-control' %>
      

      <h5><b>Service Details</b></h5>
       <div class="input-field col s12">
        <label for= "deployments_service_details_1">1. Please provide URL for your wiki page for this specific change:</label>
        <%= form.text_field :service_details_1 ,class: 'form-group form-control'%>
      </div>
      <div class="input-field col s12">
        <label for= "deployments_service_details_2">2. Please provide datadog dashboard URL for your service:</label>
        <%= form.text_field :service_details_2 ,class: 'form-group form-control'%>
      </div>
      <div class="input-field col s12">
        <label for= "deployments_service_details_3">3. Please provide newrelic dashboard URL for your service:</label>
        <%= form.text_field :service_details_3 ,class: 'form-group form-control' %>
      </div>

      <h5><b>Service Rollback</b></h5>
      <div class="input-field col s12">
        <label for= "deployments_service_rollback_1">1. What’s your rollback strategy:</label>
        <%= form.text_area :service_rollback_1 ,class: 'materialize-textarea form-group form-control' %>
      </div>
      <div class="input-field col s12">
        <label for= "deployments_service_rollback_2">2. Do you switch rollback with feature flag or does it require complete deployment again?</label>
        <%= form.text_field :service_rollback_2 ,class: 'form-group form-control' %>
      </div>

      <h5><b>Service Component - Database</b></h5>
      <%= form.text_field :service_component_database ,class: 'form-group form-control' %>

      <h5><b>Service Component - Security</b></h5>
      <%= form.text_field :service_component_security ,class: 'form-group form-control' %>

      <h5><b>Service Component - Monitoring</b></h5>
      <div class="input-field col s12">
        <label for= "deployments_service_component_monitoring">List all the services you own and list down each server monitoring parameters</label>
        <%= form.text_area :service_component_monitoring ,class: 'materialize-textarea form-group form-control' %>
      </div>

      <h5><b>Service Component - Cache</b></h5>
      <%= form.text_field :service_component_cache ,class: 'form-group form-control' %>

      <h5><b>Service Component - API Changes</b></h5>
      <%= form.text_field :service_component_api_changes ,class: 'form-group form-control' %>
      <div class="input-field col s12">
        <label for= "deployments_service_component_api_changes_1">1. Did you change API contract?</label>
        <%= form.text_field :service_component_api_changes_1 ,class: 'form-group form-control' %>
      </div>
      <div class="input-field col s12">
        <label for= "deployments_service_component_api_changes_2">2. Is there versioned API for new version?</label>
        <%= form.text_field :service_component_api_changes_2 ,class: 'form-group form-control' %>
      </div>
      <div class="input-field col s12">
        <label for= "deployments_service_component_api_changes_3">3. How are you ensuring backward compatibility</label>
        <%= form.text_area :service_component_api_changes_3 ,class: 'materialize-textarea form-group form-control' %>
      </div>
      <div class="input-field col s12">
        <label for= "deployments_service_component_api_changes_4">4. Is there is feature flag for this API to switch on and switch off?</label>
        <%= form.text_field :service_component_api_changes_4 ,class: 'form-group form-control' %>
      </div>
      <div class="input-field col s12">
        <label for= "deployments_service_component_api_changes_5">5. What kind of API is this - does it make changes to database? Please provide API endpoint, protocol (http, grpc) and signature affected data contract.</label>
        <br>
        <%= form.text_area :service_component_api_changes_5 ,class: 'materialize-textarea form-group form-control' %>
      </div>

      <h5><b>Service Component - Analytics Impact</b></h5>
      <div class="input-field col s12">
        <label for="deployments_service_component_analytics_impact_1">1. Does your change impact BI, if yes, please explain how? And get a approval from Crystal.</label>
        <%= form.text_area :service_component_analytics_impact_1 ,class: 'materialize-textarea form-group form-control' %>
      </div>

      <h5><b>Service Component - Consumer App Impact</b></h5>
      <div class="input-field col s12">
        <label for="deployments_service_component_consumer_app_impact_1" >1. Does your change impact mobile consumer app? If yes, how does it impact</label>
        <%= form.text_area :service_component_consumer_app_impact_1 ,class: 'materialize-textarea form-group form-control' %>
      </div>
      <div class="input-field col s12">
        <label for="deployments_service_component_consumer_app_impact_2">2. What components does it impact on Consumer App</label>
        <%= form.text_area :service_component_consumer_app_impact_2 ,class: 'materialize-textarea form-group form-control' %>
      </div>
      <div class="input-field col s12">
        <label for="deployments_service_component_consumer_app_impact_3">3.Are these features toggled for specific consumers or all of them?</label>
        <%= form.text_field :service_component_consumer_app_impact_3 ,class: 'form-group form-control' %>
      </div>
      <div class="input-field col s12">
        <label for="deployments_service_component_consumer_app_impact_4">4. How will you ensure staggered roll out</label>
        <%= form.text_area :service_component_consumer_app_impact_4 ,class: 'materialize-textarea form-group form-control' %>
      </div>
      <div class="input-field col s12">
        <label for="deployments_service_component_consumer_app_impact_5">5. Is there mixpanel configuration or play store configuration?</label>
        <%= form.text_field :service_component_consumer_app_impact_5 ,class: 'form-group form-control' %>
      </div>

      <h5 ><b>Service Component - Driver App Impact</b></h5>
      <%= form.text_area :service_component_driver_app_impact ,class: 'materialize-textarea form-group form-control' %>

      <h5 ><b>Service Component - GoResto App Impact</b></h5>
      <%= form.text_area :service_component_goresto_app_impact ,class: 'materialize-textarea form-group form-control' %>

      <h5><b>Service Component - Configuration Management Impact</b></h5>
      <%= form.text_area :service_component_configuration_management_impact ,class: 'materialize-textarea form-group form-control' %>

      <h5><b>Service Component - System Configurations</b></h5>
      <div class="input-field col s12">
        <label for="deployments_service_component_system_configurations_1">1. Did you check limits</label>
        <%= form.text_field :service_component_system_configurations_1 ,class: 'form-group form-control' %>
      </div>  
      <div class="input-field col s12">
        <label for="deployments_service_component_system_configurations_2">2. Did you check proxy update</label>
        <%= form.text_field :service_component_system_configurations_2 ,class: 'form-group form-control' %>
      </div>
      <div class="input-field col s12">
        <label for="deployments_service_component_system_configurations_3">3. Does it require rollover deployment</label>
        <%= form.text_field :service_component_system_configurations_3 ,class: 'form-group form-control' %>
      </div>
      <div class="input-field col s12">
        <label for="deployments_service_component_system_configurations_4">4. Does your code deployment requires full chef run on box</label>
        <%= form.text_field :service_component_system_configurations_4 ,class: 'form-group form-control' %>
      </div>
      <div class="input-field col s12">
        <label for="deployments_service_component_system_configurations_5">5. How many boxes does this service deploy affect, list each of them.</label>
        <%= form.text_area :service_component_system_configurations_5 ,class: 'materialize-textarea form-group form-control' %>
      </div>
      <div class="input-field col s12">
        <label for="deployments_service_component_system_configurations_6">6. Do you have read and write clusters, please explain order of deployment</label>
        <%= form.text_area :service_component_system_configurations_6 ,class: 'materialize-textarea form-group form-control' %>
      </div>
      <div class="input-field col s12">
        <label for="deployments_service_component_system_configurations_7">7. Does your service implements circuit breaker? If yes, what’s the configuration?</label>
        <%= form.text_area :service_component_system_configurations_7 ,class: 'materialize-textarea form-group form-control' %>
      </div>
      <div class="input-field col s12">
        <label for="deployments_service_component_system_configurations_8">8. What’s the connection timeout configuration?</label>
        <%= form.text_area :service_component_system_configurations_8 ,class: 'materialize-textarea form-group form-control' %>
      </div>
      <div class="input-field col s12">
        <label for="deployments_service_component_system_configurations_9">9.What errors you would return if there are timeouts or internal errors?</label>
        <%= form.text_area :service_component_system_configurations_9 ,class: 'materialize-textarea form-group form-control' %>
      </div>

      <h5><b>Project component - Code</b></h5>
      <div class="input-field col s12">
        <label for="deployments_project_component_code_1">1. List down commits with acceptance criteria, if it’s adhoc, mention adhoc, if it’s adhoc thenget sign off from tech lead and product manager, ask them to document this ad-hoc storyand put a proper sign off</label>
        <br>
        <%= form.text_area :project_component_code_1 ,class: 'materialize-textarea form-group form-control' %>
      </div>
      <div class="input-field col s12">
        <label for="deployments_project_component_code_2">2. What kind of tests you have written for which acceptance criteria</label>
        <%= form.text_area :project_component_code_2 ,class: 'materialize-textarea form-group form-control' %>
      </div>
      <div class="input-field col s12">
        <label for="deployments_project_component_code_3">3. Does your code deals with concurrency?</label>
        <%= form.text_field :project_component_code_3 ,class: 'form-group form-control' %>
      </div>
      <div class="input-field col s12">
        <label for="deployments_project_component_code_4">4 .Are you from reading or writing to files</label>
        <%= form.text_field :project_component_code_4 ,class: 'form-group form-control' %>
      </div>
      <div class="input-field col s12">
        <label for="deployments_project_component_code_5">5. Are you reading or writing to same fields?</label>
        <%= form.text_field :project_component_code_5 ,class: 'form-group form-control' %>
      </div>
      <div class="input-field col s12">
        <label for="deployments_project_component_code_6">6. How many domain entities are impacted?</label>
        <%= form.text_field :project_component_code_6 ,class: 'form-group form-control' %>
      </div>
      <div class="input-field col s12">
        <label for="deployments_project_component_code_7">7. Do you read from database? If yes, then explain why do you need to read from database?And why don’t you use cache, also, how many places you utilise cache.</label><br>
        <%= form.text_area :project_component_code_7 ,class: 'materialize-textarea form-group form-control' %>
      </div>
      <div class="input-field col s12">
        <label for="deployments_project_component_code_8">8. How many synnous calls your code makes? (Also list down in impacted services)</label>
        <%= form.text_area :project_component_code_8 ,class: 'materialize-textarea form-group form-control' %>
      </div>
      <label style="font-size: 18px;">Choose a reviewer to mail</label>
      <div class="input-field col s12">
        <%= form.select :reviewer_email, User.all.collect { |x| x.email }, {:include_blank => "Select One"} %>
      </div>
        <%= hidden_field_tag 'user_id', @deployment.user_id  %>
        <%= hidden_field_tag 'project_name', @deployment.project_name  %>
        <%= hidden_field_tag 'project_id', @project_id %>
        <%= hidden_field_tag 'commit_id', @deployment.commit_id  %>
        <%= hidden_field_tag 'last_deployed_commit', @last_deployed_commit  %>
        <%= form.submit  class: 'btn btn-primary' %>
    <%end %>
  </div>
</div>
<footer class="page-footer"></footer>
